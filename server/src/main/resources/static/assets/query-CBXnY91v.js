var E=i=>{throw TypeError(i)};var R=(i,t,e)=>t.has(i)||E("Cannot "+e);var r=(i,t,e)=>(R(i,t,"read from private field"),e?e.call(i):t.get(i)),f=(i,t,e)=>t.has(i)?E("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(i):t.set(i,e),l=(i,t,e,s)=>(R(i,t,"write to private field"),s?s.call(i,e):t.set(i,e),e),p=(i,t,e)=>(R(i,t,"access private method"),e);import{r as M}from"./chunk-HA7DTUK3-DrNZtXfs.js";import{y as K,R as O,x as T,b as k,q as Q,s as H,w as j,k as z,n as B,e as N,z as A}from"./QueryClientProvider-BzrRjjnv.js";function W(i={}){const{strict:t=!0,errorMessage:e="useContext: `context` is undefined. Seems you forgot to wrap component within the Provider",name:s}=i,o=M.createContext(void 0);o.displayName=s;function D(){var c;const C=M.useContext(o);if(!C&&t){const b=new Error(e);throw b.name="ContextError",(c=Error.captureStackTrace)==null||c.call(Error,b,D),b}return C}return[o.Provider,D,o]}var[X,Y]=W({name:"ProviderContext",strict:!1}),S,F,u,v,n,x,m,d,y,G,Z=(G=class extends O{constructor(t){super();f(this,d);f(this,S);f(this,F);f(this,u);f(this,v);f(this,n);f(this,x);f(this,m);l(this,m,!1),l(this,x,t.defaultOptions),this.setOptions(t.options),this.observers=[],l(this,v,t.client),l(this,u,r(this,v).getQueryCache()),this.queryKey=t.queryKey,this.queryHash=t.queryHash,l(this,S,$(this.options)),this.state=t.state??r(this,S),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var t;return(t=r(this,n))==null?void 0:t.promise}setOptions(t){this.options={...r(this,x),...t},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&r(this,u).remove(this)}setData(t,e){const s=T(this.state.data,t,this.options);return p(this,d,y).call(this,{data:s,type:"success",dataUpdatedAt:e==null?void 0:e.updatedAt,manual:e==null?void 0:e.manual}),s}setState(t,e){p(this,d,y).call(this,{type:"setState",state:t,setStateOptions:e})}cancel(t){var s,o;const e=(s=r(this,n))==null?void 0:s.promise;return(o=r(this,n))==null||o.cancel(t),e?e.then(k).catch(k):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(r(this,S))}isActive(){return this.observers.some(t=>Q(t.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===H||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStale(){return this.state.isInvalidated?!0:this.getObserversCount()>0?this.observers.some(t=>t.getCurrentResult().isStale):this.state.data===void 0}isStaleByTime(t=0){return this.state.isInvalidated||this.state.data===void 0||!j(this.state.dataUpdatedAt,t)}onFocus(){var e;const t=this.observers.find(s=>s.shouldFetchOnWindowFocus());t==null||t.refetch({cancelRefetch:!1}),(e=r(this,n))==null||e.continue()}onOnline(){var e;const t=this.observers.find(s=>s.shouldFetchOnReconnect());t==null||t.refetch({cancelRefetch:!1}),(e=r(this,n))==null||e.continue()}addObserver(t){this.observers.includes(t)||(this.observers.push(t),this.clearGcTimeout(),r(this,u).notify({type:"observerAdded",query:this,observer:t}))}removeObserver(t){this.observers.includes(t)&&(this.observers=this.observers.filter(e=>e!==t),this.observers.length||(r(this,n)&&(r(this,m)?r(this,n).cancel({revert:!0}):r(this,n).cancelRetry()),this.scheduleGc()),r(this,u).notify({type:"observerRemoved",query:this,observer:t}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||p(this,d,y).call(this,{type:"invalidate"})}fetch(t,e){var b,w,P;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(e!=null&&e.cancelRefetch))this.cancel({silent:!0});else if(r(this,n))return r(this,n).continueRetry(),r(this,n).promise}if(t&&this.setOptions(t),!this.options.queryFn){const a=this.observers.find(h=>h.options.queryFn);a&&this.setOptions(a.options)}const s=new AbortController,o=a=>{Object.defineProperty(a,"signal",{enumerable:!0,get:()=>(l(this,m,!0),s.signal)})},D=()=>{const a=N(this.options,e),h={client:r(this,v),queryKey:this.queryKey,meta:this.meta};return o(h),l(this,m,!1),this.options.persister?this.options.persister(a,h,this):a(h)},c={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:r(this,v),state:this.state,fetchFn:D};o(c),(b=this.options.behavior)==null||b.onFetch(c,this),l(this,F,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((w=c.fetchOptions)==null?void 0:w.meta))&&p(this,d,y).call(this,{type:"fetch",meta:(P=c.fetchOptions)==null?void 0:P.meta});const C=a=>{var h,g,U,q;A(a)&&a.silent||p(this,d,y).call(this,{type:"error",error:a}),A(a)||((g=(h=r(this,u).config).onError)==null||g.call(h,a,this),(q=(U=r(this,u).config).onSettled)==null||q.call(U,this.state.data,a,this)),this.scheduleGc()};return l(this,n,z({initialPromise:e==null?void 0:e.initialPromise,fn:c.fetchFn,abort:s.abort.bind(s),onSuccess:a=>{var h,g,U,q;if(a===void 0){C(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(a)}catch(I){C(I);return}(g=(h=r(this,u).config).onSuccess)==null||g.call(h,a,this),(q=(U=r(this,u).config).onSettled)==null||q.call(U,a,this.state.error,this),this.scheduleGc()},onError:C,onFail:(a,h)=>{p(this,d,y).call(this,{type:"failed",failureCount:a,error:h})},onPause:()=>{p(this,d,y).call(this,{type:"pause"})},onContinue:()=>{p(this,d,y).call(this,{type:"continue"})},retry:c.options.retry,retryDelay:c.options.retryDelay,networkMode:c.options.networkMode,canRun:()=>!0})),r(this,n).start()}},S=new WeakMap,F=new WeakMap,u=new WeakMap,v=new WeakMap,n=new WeakMap,x=new WeakMap,m=new WeakMap,d=new WeakSet,y=function(t){const e=s=>{switch(t.type){case"failed":return{...s,fetchFailureCount:t.failureCount,fetchFailureReason:t.error};case"pause":return{...s,fetchStatus:"paused"};case"continue":return{...s,fetchStatus:"fetching"};case"fetch":return{...s,..._(s.data,this.options),fetchMeta:t.meta??null};case"success":return{...s,data:t.data,dataUpdateCount:s.dataUpdateCount+1,dataUpdatedAt:t.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!t.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const o=t.error;return A(o)&&o.revert&&r(this,F)?{...r(this,F),fetchStatus:"idle"}:{...s,error:o,errorUpdateCount:s.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:s.fetchFailureCount+1,fetchFailureReason:o,fetchStatus:"idle",status:"error"};case"invalidate":return{...s,isInvalidated:!0};case"setState":return{...s,...t.state}}};this.state=e(this.state),B.batch(()=>{this.observers.forEach(s=>{s.onQueryUpdate()}),r(this,u).notify({query:this,type:"updated",action:t})})},G);function _(i,t){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:K(t.networkMode)?"fetching":"paused",...i===void 0&&{error:null,status:"pending"}}}function $(i){const t=typeof i.initialData=="function"?i.initialData():i.initialData,e=t!==void 0,s=e?typeof i.initialDataUpdatedAt=="function"?i.initialDataUpdatedAt():i.initialDataUpdatedAt:0;return{data:t,dataUpdateCount:0,dataUpdatedAt:e?s??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:e?"success":"pending",fetchStatus:"idle"}}export{X as P,Z as Q,W as c,_ as f,Y as u};
